# PointIn 视频播放器功能清单

## 1. 核心播放功能

### 1.1 Video.js 播放器
- **播放器初始化**: 使用Video.js 8.23.3版本，禁用默认控制栏
- **视频格式支持**: MP4, WebM, OGG, MOV, M4V, AVI, MKV
- **多源配置**: 为不同格式提供多个MIME类型选项以提高兼容性
- **播放控制**: 播放/暂停、跳转、全屏
- **音量控制**: 音量调节、静音切换
- **播放速度**: 支持0.1x到16x多级播放倍速调节
- **编解码器检测**: 检查浏览器对各种视频编解码器的支持

### 1.2 文件管理
- **文件选择**: 通过Electron原生文件对话框选择视频文件
- **文件格式验证**: 检查文件扩展名是否为支持的格式
- **错误处理**: 显示格式不支持提示和故障排除建议
- **历史记录**: 记住上次打开的文件功能
- **自动加载**: 启动时自动打开上次播放的视频（可选）

## 2. 用户界面

### 2.1 主界面布局
- **全屏视频区域**: 填满窗口的视频播放区域
- **右侧侧边栏**: 可展开/收起的控制面板
- **左侧大纲面板**: 可展开/收起的打点大纲视图
- **浮动播放按钮**: 左下角的播放/暂停快捷按钮
- **文件信息浮层**: 显示加载状态和提示信息

### 2.2 侧边栏功能
- **文件操作区**: 选择视频文件、记住上次文件选项
- **播放控制区**: 全屏按钮等控制选项
- **播放信息区**: 显示文件名、时长、当前时间、音量、播放速度
- **高级功能区**: 编解码器支持检查等工具
- **自适应显示**: 无视频时自动显示，有视频时可收起

### 2.3 视觉效果
- **响应式动画**: 侧边栏展开/收起动画
- **状态指示**: 播放状态、加载状态的视觉反馈
- **时长显示**: 右下角显示视频总时长
- **播放倍速提示**: 调整倍速时的临时显示

## 3. 进度条系统

### 3.1 基础进度条
- **时间轴显示**: 显示视频播放进度
- **拖拽跳转**: 点击或拖拽进度条跳转到指定时间
- **时间提示**: 鼠标悬停显示对应时间点
- **当前时间显示**: 跟随播放进度的时间标记

### 3.2 进度条缩放功能
- **缩放控制**: 支持进度条的放大缩小查看
- **平移操作**: 缩放后可平移查看不同时间段
- **自定义滑块**: 可拖拽调整的时间范围选择器
- **滑块拖拽**: 支持滑块主体拖拽移动位置
- **边缘调整**: 支持拖拽滑块左右边缘调整范围
- **跟随播放**: 可选择让视窗跟随播放进度自动移动
- **时间范围显示**: 显示当前视窗对应的开始和结束时间
- **播放进度指示器**: 在缩放轨道上显示当前播放位置
- **播放手柄拖拽**: 支持拖拽播放手柄跳转时间
- **点击跳转**: 点击缩放轨道直接跳转到对应时间
- **最小宽度控制**: 基于视频时长动态计算最小滑块宽度

### 3.3 缩略图预览
- **悬停预览**: 鼠标悬停在进度条上显示对应时间点的视频帧
- **缓存机制**: 智能缓存生成的缩略图，提高性能
- **多画布支持**: 支持主进度条和缩放进度条的独立缩略图
- **错误处理**: 缩略图生成失败时显示占位符

## 4. 打点系统 (Annotation System)

### 4.1 打点管理
- **添加打点**: 在当前播放时间添加打点标记
- **打点编辑**: 编辑打点的标题、内容、颜色、级别
- **打点删除**: 删除不需要的打点
- **时长设置**: 支持设置打点的持续时间
- **自动保存**: 打点数据自动保存到对应的JSON文件
- **跳转功能**: 点击打点可跳转到对应的时间位置

### 4.2 打点分类
- **颜色分类**: 支持蓝色、绿色、黄色、红色、紫色、橙色等多种颜色
- **级别分类**: 支持高、中、低三个级别的层次结构
- **时间排序**: 打点按时间顺序自动排列
- **播放状态**: 显示打点是否已播放完成
- **动态级别高度**: 根据存在的级别动态分配显示高度

### 4.3 打点可视化显示
- **进度条上的圆点**: 在主进度条上显示打点位置
- **级别高度映射**: 不同级别的打点显示在不同高度
- **颜色区分**: 打点圆点使用对应的颜色显示
- **时长条**: 有持续时间的打点显示为条形而非圆点
- **悬停弹出框**: 鼠标悬停显示打点详细信息
- **缩略打点**: 在缩放轨道上显示简化的打点标记

### 4.4 打点交互功能
- **悬停预览**: 鼠标悬停显示包含时间、标题、内容的弹出框
- **快速编辑**: 弹出框中提供编辑和删除按钮
- **模态框编辑**: 完整的打点编辑模态框
- **键盘快捷键**: Enter键快速添加打点
- **事件冒泡控制**: 防止打点操作干扰进度条拖拽

### 4.5 打点文件管理
- **独立存储**: 每个视频文件对应独立的.pointin.json打点文件
- **自动加载**: 打开视频时自动加载对应的打点文件
- **数据持久化**: 打点数据保存在本地JSON文件中
- **文件路径关联**: 打点文件与视频文件路径自动关联

## 5. 大纲视图

### 5.1 大纲面板
- **左侧面板**: 可展开/收起的大纲视图面板
- **拖拽调整**: 支持拖拽调整面板宽度
- **宽度记忆**: 记住用户设置的面板宽度

### 5.2 大纲内容
- **层次显示**: 按级别缩进显示打点结构
- **时间跳转**: 点击打点时间可跳转到对应位置
- **快速编辑**: 点击标题或内容可快速打开编辑窗口
- **删除操作**: 直接在大纲中删除打点

### 5.3 折叠功能
- **层次折叠**: 支持按层次折叠/展开打点
- **批量操作**: 支持展开/折叠所有项目
- **级别切换**: 支持按级别批量展开/折叠
- **状态记忆**: 记住折叠状态
- **智能折叠**: 只有有下级内容的打点才显示折叠控制
- **折叠计数**: 显示被折叠的子项数量
- **自动清理**: 自动清理无效的折叠状态

## 6. 键盘快捷键

### 6.1 播放控制
- **空格键**: 播放/暂停切换
- **F键**: 全屏/退出全屏
- **M键**: 静音/取消静音

### 6.2 时间跳转
- **左箭头**: 后退5秒（Shift+左箭头：30秒，Ctrl/Cmd+左箭头：60秒）
- **右箭头**: 前进5秒（Shift+右箭头：30秒，Ctrl/Cmd+右箭头：60秒）

### 6.3 播放速度
- **上箭头**: 增加播放倍速
- **下箭头**: 减少播放倍速

### 6.4 打点操作
- **Enter键**: 在当前时间添加打点

## 7. 历史记录功能

### 7.1 文件记录
- **上次文件**: 记住上次打开的视频文件路径
- **自动打开**: 启动时可自动打开上次的文件
- **文件存在检查**: 检查上次文件是否仍然存在
- **路径显示**: 显示上次文件的简化路径

### 7.2 设置持久化
- **Checkbox状态**: 记住"记住上次文件"选项的状态
- **历史数据**: 保存在独立的历史记录文件中

## 8. 性能优化

### 8.1 缓存机制
- **缩略图缓存**: 缓存生成的视频帧缩略图
- **防抖处理**: 对频繁更新的操作进行防抖优化
- **内存管理**: 限制缓存大小，自动清理旧缓存

### 8.2 事件优化
- **节流更新**: 对播放状态更新进行节流处理
- **条件渲染**: 只在面板打开时更新大纲视图
- **事件委托**: 合理使用事件委托减少监听器数量

## 9. 错误处理与用户体验

### 9.1 错误处理
- **格式检查**: 检查视频文件格式支持
- **加载失败**: 显示加载失败的友好提示
- **故障排除**: 提供针对不同格式的故障排除建议
- **编解码器提示**: 显示浏览器编解码器支持信息

### 9.2 用户反馈
- **加载状态**: 显示视频加载进度和状态
- **操作提示**: 显示操作结果和提示信息
- **视觉反馈**: 按钮状态、播放状态的视觉指示
- **时间显示**: 多处显示当前时间和总时长

## 10. Electron集成

### 10.1 主进程通信
- **文件对话框**: 使用Electron原生文件选择对话框
- **菜单集成**: 支持通过应用菜单打开文件
- **文件系统**: 读写打点文件和历史记录文件
- **文件存在检查**: 检查文件是否存在

### 10.2 安全配置
- **CSP设置**: 配置内容安全策略
- **本地文件访问**: 支持file://协议访问本地视频文件
- **webSecurity**: 动态配置web安全选项

## 11. 样式与主题

### 11.1 视觉设计
- **现代UI**: 使用现代化的界面设计
- **色彩系统**: 统一的色彩搭配方案
- **图标系统**: SVG图标的使用
- **动画效果**: 平滑的过渡动画

### 11.2 响应式布局
- **固定布局**: 专为桌面端设计的固定布局
- **组件适配**: 各组件在不同状态下的自适应显示
- **面板调整**: 支持面板宽度的动态调整

## 12. 数据存储

### 12.1 打点数据
- **JSON格式**: 使用JSON格式存储打点数据
- **文件命名**: 视频文件名.pointin.json的命名规则
- **数据结构**: 包含时间、标题、内容、颜色、级别、时长、创建时间等信息
- **数据验证**: 时间精度保留2位小数
- **自动排序**: 打点按时间顺序自动排列存储

### 12.2 配置数据
- **历史记录**: 存储在独立的历史记录文件中
- **用户设置**: 面板宽度等用户偏好设置
- **本地存储**: 使用localStorage存储临时设置
- **折叠状态**: 大纲面板的折叠状态管理

## 13. 高级交互功能

### 13.1 事件处理优化
- **事件冒泡控制**: 精确控制事件冒泡，防止操作冲突
- **防抖节流**: 对频繁触发的事件进行防抖和节流处理
- **多重事件监听**: 支持同一元素的多种交互方式

### 13.2 状态同步
- **播放状态同步**: 多个UI组件的播放状态实时同步
- **时间显示同步**: 各处时间显示保持一致
- **打点状态同步**: 进度条和大纲视图的打点状态同步

### 13.3 用户体验优化
- **智能隐藏**: 播放时自动隐藏浮动按钮
- **渐进加载**: 缩略图和打点的渐进式加载
- **平滑动画**: 各种状态切换的平滑动画效果
- **视觉反馈**: 操作的即时视觉反馈

## 14. 模态框系统

### 14.1 打点编辑模态框
- **统一编辑界面**: 新建和编辑打点使用同一模态框
- **表单验证**: 输入内容的验证和处理
- **键盘支持**: 支持Enter确认、Escape取消
- **焦点管理**: 智能的焦点管理和字段选择
- **实时预览**: 颜色和级别选择的实时预览

### 14.2 模态框交互
- **背景点击关闭**: 点击背景区域关闭模态框
- **键盘导航**: 支持Tab键在表单字段间导航
- **数据回填**: 编辑时自动回填现有数据
- **取消确认**: 有未保存更改时的确认提示
