<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <!-- Content Security Policy - 消除Electron警告，避免unsafe-eval -->
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' data: blob: filesystem:; script-src * 'unsafe-inline' data: blob:; style-src * 'unsafe-inline' data: blob:; img-src * data: blob: filesystem:; font-src * data: blob: filesystem:; connect-src * data: blob: filesystem:; media-src * data: blob: filesystem:; object-src *; child-src *; frame-src *; worker-src * blob:; form-action *;">
  <title>VideoTalker - 视频播放器</title>

  <!-- Video.js CSS -->
  <link href="./lib/video.js/8.23.3/video-js.css" rel="stylesheet">

  <!-- LESS 样式表 -->
  <link rel="stylesheet/less" type="text/css" href="styles.less" />

  <!-- LESS 编译器 -->
  <script src="./node_modules/less/dist/less.min.js"></script>

</head>

<body>
     <!-- 左侧大纲切换按钮 -->
   <button id="outline-toggle-btn" class="outline-toggle-btn" title="打点大纲">
     <!-- 列表图标 -->
     <svg class="list-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
       <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
     </svg>
     <!-- 关闭图标 -->
     <svg class="close-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
       <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
     </svg>
   </button>

  <!-- 左侧大纲视图面板 -->
  <div id="outline-panel" class="outline-panel">
    <div class="outline-panel-header">
      <h3>打点大纲</h3>
      <button id="outline-close-btn" class="outline-close-btn">&times;</button>
    </div>
    <div class="outline-panel-content">
      <div id="outline-list" class="outline-list">
        <!-- 打点列表将在这里动态生成 -->
      </div>
    </div>
  </div>

  <!-- 主内容区域 -->
  <div class="main-content">
    <!-- 全屏视频容器 -->
    <div class="video-container">
      <video id="video-player" class="video-js vjs-default-skin" preload="auto" data-setup="{}">
        <p class="vjs-no-js">
          要查看此视频，请启用 JavaScript，并考虑升级到
          <a href="https://videojs.com/html5-video-support/" target="_blank">
            支持HTML5视频的网络浏览器
          </a>。
        </p>
      </video>
    </div>

    <!-- 文件信息浮层 -->
    <div class="file-info-overlay" id="file-info-overlay">
      请选择一个视频文件开始播放
    </div>

    <!-- 播放倍速提示 -->
    <div class="playback-rate-display" id="playback-rate-display">
      <span class="rate-text" id="rate-text">1.0x</span>
    </div>


    <!-- 展开按钮 -->
    <button class="expand-button" id="expand-button">›</button>
    <!-- 右侧侧边栏 -->
    <div class="overlay-ui" id="overlay-ui">
      <!-- 侧边栏头部 -->
      <div class="sidebar-header">
        <h1 class="app-title">VideoTalker</h1>
        <p class="app-subtitle">视频播放器</p>
      </div>

      <!-- 控制区域 -->
      <div class="control-section">
        <div class="section-title">文件操作</div>
        <div class="controls">
          <button class="btn primary" id="open-file">
            <span>选择视频文件</span>
            <span>📁</span>
          </button>
          <div class="checkbox-container">
            <label class="checkbox-label">
              <input type="checkbox" id="remember-last-file" />
              <span class="checkmark"></span>
              <span class="checkbox-text">记住上次打开的文件</span>
            </label>
            <div class="last-file-path" id="last-file-path" style="display: none;">
              <span class="path-label">上次文件：</span>
              <span class="path-text" id="path-text"></span>
            </div>
          </div>
        </div>
      </div>

      <!-- 播放控制区域 (仅在有视频时显示) -->
      <div class="control-section hide-when-no-video" id="playback-controls">
        <div class="section-title">播放控制</div>
        <div class="controls">
          <button class="btn" id="fullscreen">
            <span>全屏播放</span>
            <span>⛶</span>
          </button>
        </div>
      </div>

      <!-- 播放信息 (仅在有视频时显示) -->
      <div class="info-section hide-when-no-video" id="video-info">
        <div class="section-title">播放信息</div>
        <div class="panel-item">
          <div class="panel-label">文件名</div>
          <div class="panel-value" id="panel-filename">未选择文件</div>
        </div>
        <div class="panel-item">
          <div class="panel-label">时长</div>
          <div class="panel-value" id="panel-duration">--:--</div>
        </div>
        <div class="panel-item">
          <div class="panel-label">当前时间</div>
          <div class="panel-value" id="panel-current-time">--:--</div>
        </div>
        <div class="panel-item">
          <div class="panel-label">音量</div>
          <div class="panel-value" id="panel-volume">100%</div>
        </div>
        <div class="panel-item">
          <div class="panel-label">播放速度</div>
          <div class="panel-value" id="panel-playback-rate">1.0x</div>
        </div>
      </div>

      <!-- 高级功能 -->
      <div class="control-section">
        <div class="section-title">高级功能</div>
        <div class="controls">
          <button class="btn" id="check-support">
            <span>检查格式支持</span>
            <span>🔍</span>
          </button>
        </div>
      </div>
    </div>
  </div> <!-- 关闭 main-content -->
  <!-- 视频进度条容器 -->
  <div class="progress-wrapper" id="progress-wrapper">
    <!-- 进度条缩放控制 -->
    <div class="progress-zoom-control" id="progress-zoom-control">
      <div class="pan-section">
        <div class="custom-pan-slider" id="custom-pan-slider">
          <div class="pan-track"></div>
          <div class="playback-indicator" id="playback-indicator"></div>
          <div class="pan-thumb" id="pan-thumb">
            <div class="resize-handle left-handle" id="left-handle"></div>
            <div class="resize-handle right-handle" id="right-handle"></div>
            <div class="thumb-time-display left-time" id="thumb-start-time">00:00</div>
            <div class="thumb-time-display right-time" id="thumb-end-time">00:00</div>
                         <div class="pan-thumb-controls">
               <button id="pan-thumb-follow-btn" class="pan-thumb-follow-btn" data-following="false">
                 <span class="btn-text">自由</span>
               </button>
             </div>
          </div>
          <div class="playback-progress" id="playback-progress">
            <div class="playback-tooltip" id="playback-tooltip">
              <canvas class="playback-thumbnail-canvas" id="playback-thumbnail-canvas" width="160"
                height="90"></canvas>
              <div class="playback-tooltip-line"></div>
              <div class="playback-tooltip-text" id="playback-tooltip-text">00:00</div>
            </div>
          </div>
          <div class="playback-handle" id="playback-handle">
            <div class="playback-handle-time" id="playback-handle-time">00:00</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 视频进度条 -->
    <div class="progress-container" id="progress-container">
      <!-- 总时间轨道（橙色） -->
      <div class="progress-bar-track" id="progress-bar-track"></div>
      <div class="progress-bar" id="progress-bar">
        <div class="progress-line"></div>
        <div class="progress-handle">
          <div class="current-time-display" id="current-time-display">
            <span class="time-text">00:00</span>
            <button class="add-annotation-btn" id="add-annotation-btn" title="添加打点"></button>
          </div>
        </div>
      </div>
      <div class="progress-tooltip" id="progress-tooltip">
        <canvas class="main-thumbnail-canvas" id="main-thumbnail-canvas" width="160" height="90"></canvas>
        <div class="tooltip-line"></div>
        <div class="tooltip-text" id="tooltip-text">00:00</div>
      </div>
    </div>
  </div>
  <!-- 左下角播放/暂停按钮 -->
  <button class="floating-play-button" id="floating-play-button">
    <div class="play-icon" id="play-icon"></div>
    <div class="pause-icon" id="pause-icon" style="display: none;"></div>
  </button>

  <!-- 视频总时长显示 -->
  <div class="video-duration-display" id="video-duration-display">
    <span class="duration-text">00:00</span>
  </div>

  <!-- Video.js JavaScript -->
  <script src="./lib/video.js/8.23.3/video.min.js"></script>
  <script src="annotations.js"></script>
  <script src="renderer.js"></script>
</body>

</html>